<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kinderfreizeit Olympiade â€“ Flexibles Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans">

<div class="flex flex-col md:flex-row min-h-screen relative">
    
  <div id="clock" class="absolute top-4 right-4 text-2xl md:text-4xl font-mono bg-black/60 px-6 py-3 rounded-xl shadow-lg z-20 border border-gray-700">
    00:00:00
  </div>

  <div class="w-full md:w-1/2 p-4 md:p-12 flex flex-col justify-center border-b md:border-b-0 md:border-r border-gray-700">
    <h1 class="text-3xl md:text-6xl font-extrabold mb-8 md:mb-12 text-center pt-12 md:pt-0 tracking-tight">
      ğŸ… Medaillenspiegel
    </h1>
    
    <div id="scoreboard" class="space-y-4 md:space-y-6 w-full max-w-md md:max-w-3xl mx-auto">
      <p class="text-center animate-pulse text-xl">Daten werden geladen...</p>
    </div>
  </div>

  <div class="w-full md:w-1/2 bg-gray-800 p-4 md:p-12 flex flex-col justify-center">
    <h2 class="text-3xl md:text-5xl font-bold mb-8 md:mb-12 text-center pt-8 md:pt-0 text-gray-200">
      ğŸ“… Tagesablauf
    </h2>
    <div id="schedule" class="space-y-4 md:space-y-8 text-xl md:text-3xl w-full max-w-md md:max-w-3xl mx-auto">
      </div>
  </div>

</div>

<script>
// URLS DEINER GOOGLE SHEETS (CSV EXPORT)
const MEDAL_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTl8ONEJhICDqDwsal3S1JazhwpI80LhIDD3MdpDiW1T4MJlL8RzX9k4Pq703VY12qRJpzOeZcpD8ZV/pub?gid=0&single=true&output=csv';
const SCHEDULE_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTl8ONEJhICDqDwsal3S1JazhwpI80LhIDD3MdpDiW1T4MJlL8RzX9k4Pq703VY12qRJpzOeZcpD8ZV/pub?gid=1373310417&single=true&output=csv';

function parseCSV(text) {
  return text.split('\n')
             .map(line => line.split(',').map(cell => cell.trim()))
             .filter(row => row.length > 1 && row[0] !== "");
}

async function updateDashboard() {
  try {
    // 1. MEDAILLEN & TEAMS LADEN
    const medalResponse = await fetch(MEDAL_CSV_URL);
    const medalText = await medalResponse.text();
    const medalRows = parseCSV(medalText).slice(1); // Header Ã¼berspringen

    const teams = medalRows.map(row => ({
      name:  row[0] || 'Unbekanntes Team',
      gold:   parseInt(row[1]) || 0,
      silver: parseInt(row[2]) || 0,
      bronze: parseInt(row[3]) || 0,
      flag:   row[4] || '', // Spalte E
      color:  row[5] || '#4b5563' // Spalte F (Standardgrau wenn leer)
    }));

    // Sortierung nach Gold > Silber > Bronze
    teams.sort((a, b) => (b.gold - a.gold) || (b.silver - a.silver) || (b.bronze - a.bronze));

    const scoreboardContainer = document.getElementById('scoreboard');
    scoreboardContainer.innerHTML = teams.map((team, index) => {
      
      // Platzhalter oder Flagge
      const flagContent = team.flag 
        ? `<img src="${team.flag}" class="w-10 h-10 md:w-16 md:h-16 object-contain rounded shadow-sm" alt="Flagge">`
        : `<div class="w-10 h-10 md:w-16 md:h-16 bg-white/20 rounded-full flex items-center justify-center text-sm md:text-xl font-bold">${index + 1}</div>`;

      // Textfarbe bestimmen (Hell fÃ¼r dunkle HintergrÃ¼nde, Dunkel fÃ¼r Gelb)
      const textColor = (team.color.toLowerCase() === '#yellow' || team.color.toLowerCase() === '#ffff00' || team.name.toLowerCase().includes('gelb')) 
        ? 'text-black' : 'text-white';

      return `
        <div class="flex justify-between items-center rounded-2xl p-4 md:p-8 shadow-2xl transition-all duration-500" 
             style="background-color: ${team.color};">
          <div class="flex items-center gap-4 md:gap-8">
            ${flagContent}
            <h2 class="text-xl md:text-5xl font-extrabold ${textColor} truncate drop-shadow-sm">${team.name}</h2>
          </div>
          <div class="flex gap-3 md:gap-8 text-lg md:text-4xl font-black bg-black/20 px-4 py-2 rounded-2xl backdrop-blur-md ${textColor}">
            <span>ğŸ¥‡ ${team.gold}</span>
            <span class="opacity-90">ğŸ¥ˆ ${team.silver}</span>
            <span class="opacity-80">ğŸ¥‰ ${team.bronze}</span>
          </div>
        </div>
      `;
    }).join('');

    // 2. ZEITPLAN LADEN
    const scheduleResponse = await fetch(SCHEDULE_CSV_URL);
    const scheduleText = await scheduleResponse.text();
    const scheduleRows = parseCSV(scheduleText).slice(1);

    const scheduleContainer = document.getElementById('schedule');
    scheduleContainer.innerHTML = scheduleRows.map(row => `
      <div class="flex justify-between border-b border-gray-600 pb-3 md:pb-5">
        <span class="font-bold text-blue-400">${row[0]}</span>
        <span class="text-gray-300 text-right">${row[1]}</span>
      </div>
    `).join('');

  } catch (error) {
    console.error("Fehler:", error);
  }
}

function updateClock() {
  const now = new Date();
  document.getElementById('clock').innerText = now.toLocaleTimeString('de-DE');
}

updateDashboard();
updateClock();
setInterval(updateClock, 1000);
setInterval(updateDashboard, 60000); // Alle 60 Sek. aktualisieren
</script>
</body>
</html>
