<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kinderfreizeit Olympiade â€“ Live-Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans">

<div class="flex flex-col md:flex-row min-h-screen relative">
    
  <div id="clock" class="absolute top-4 right-4 text-2xl md:text-4xl font-mono bg-black/60 px-6 py-3 rounded-xl shadow-lg z-20 border border-gray-700">
    00:00:00
  </div>

  <div class="w-full md:w-1/2 p-4 md:p-12 flex flex-col justify-center border-b md:border-b-0 md:border-r border-gray-700">
    <h1 class="text-3xl md:text-6xl font-extrabold mb-8 md:mb-12 text-center pt-12 md:pt-0 tracking-tight text-white">
      ğŸ… Medaillenspiegel
    </h1>
    
    <div id="scoreboard" class="space-y-4 md:space-y-6 w-full max-w-md md:max-w-3xl mx-auto">
      <p class="text-center animate-pulse text-xl">Lade Medaillendaten...</p>
    </div>
  </div>

  <div class="w-full md:w-1/2 bg-gray-800 p-4 md:p-12 flex flex-col justify-center">
    <h2 class="text-3xl md:text-5xl font-bold mb-8 md:mb-12 text-center pt-8 md:pt-0 text-gray-200">
      ğŸ“… Tagesablauf
    </h2>
    
    <div id="schedule" class="space-y-4 md:space-y-8 text-xl md:text-3xl w-full max-w-md md:max-w-3xl mx-auto">
      <p class="text-center animate-pulse text-xl text-gray-400">Lade Zeitplan...</p>
    </div>
  </div>

</div>

<script>
// ==========================================
// KONFIGURATION (Deine Google Sheets URLs)
// ==========================================
const MEDAL_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTl8ONEJhICDqDwsal3S1JazhwpI80LhIDD3MdpDiW1T4MJlL8RzX9k4Pq703VY12qRJpzOeZcpD8ZV/pub?gid=0&single=true&output=csv';
const SCHEDULE_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTl8ONEJhICDqDwsal3S1JazhwpI80LhIDD3MdpDiW1T4MJlL8RzX9k4Pq703VY12qRJpzOeZcpD8ZV/pub?gid=1373310417&single=true&output=csv';

// Hilfsfunktion: Erkennt Farbe basierend auf dem Teamnamen
function getTeamColorClass(name) {
  const n = name.toLowerCase();
  if (n.includes('blau')) return 'bg-blue-600 text-white';
  if (n.includes('gelb')) return 'bg-yellow-400 text-black';
  if (n.includes('schwarz')) return 'bg-gray-950 text-white border border-gray-600';
  if (n.includes('grÃ¼n') || n.includes('gruen')) return 'bg-green-600 text-white';
  if (n.includes('rot')) return 'bg-red-600 text-white';
  return 'bg-gray-700 text-white'; // Standard
}

// Hilfsfunktion: CSV Text in Array umwandeln
function parseCSV(text) {
  return text.split('\n')
             .map(line => line.split(',').map(cell => cell.trim()))
             .filter(row => row.length > 1 && row[0] !== "");
}

// ==========================================
// HAUPTFUNKTION: DATEN LADEN & ANZEIGEN
// ==========================================
async function updateDashboard() {
  try {
    // 1. MEDAILLEN LADEN
    const medalResponse = await fetch(MEDAL_CSV_URL);
    const medalText = await medalResponse.text();
    const medalRows = parseCSV(medalText).slice(1); // Header Ã¼berspringen

    const teams = medalRows.map(row => ({
      name: row[0],
      gold: parseInt(row[1]) || 0,
      silver: parseInt(row[2]) || 0,
      bronze: parseInt(row[3]) || 0
    }));

    // Sortieren: Gold > Silber > Bronze
    teams.sort((a, b) => (b.gold - a.gold) || (b.silver - a.silver) || (b.bronze - a.bronze));

    const scoreboardContainer = document.getElementById('scoreboard');
    scoreboardContainer.innerHTML = teams.map((team, index) => {
      let rankIcon = `<span class="opacity-50 font-mono w-6 text-right">${index + 1}.</span>`;
      if (index === 0) rankIcon = `<span class="text-2xl">ğŸ†</span>`;

      return `
        <div class="flex justify-between items-center ${getTeamColorClass(team.name)} rounded-2xl p-4 md:p-8 shadow-xl transition-transform">
          <div class="flex items-center gap-4">
            ${rankIcon}
            <h2 class="text-xl md:text-4xl font-bold truncate">${team.name}</h2>
          </div>
          <div class="flex gap-3 md:gap-8 text-lg md:text-3xl font-bold bg-black/20 px-4 py-2 rounded-xl backdrop-blur-sm">
            <span>ğŸ¥‡ ${team.gold}</span>
            <span class="opacity-90">ğŸ¥ˆ ${team.silver}</span>
            <span class="opacity-80">ğŸ¥‰ ${team.bronze}</span>
          </div>
        </div>
      `;
    }).join('');

    // 2. ZEITPLAN LADEN
    const scheduleResponse = await fetch(SCHEDULE_CSV_URL);
    const scheduleText = await scheduleResponse.text();
    const scheduleRows = parseCSV(scheduleText).slice(1); // Header Ã¼berspringen

    const scheduleContainer = document.getElementById('schedule');
    scheduleContainer.innerHTML = scheduleRows.map(row => `
      <div class="flex justify-between border-b border-gray-600 pb-3 md:pb-5">
        <span class="font-bold text-blue-400">${row[0]}</span>
        <span class="text-gray-300 text-right">${row[1]}</span>
      </div>
    `).join('');

  } catch (error) {
    console.error("Fehler beim Laden der Daten:", error);
  }
}

// ==========================================
// UHRZEIT & AUTO-REFRESH
// ==========================================
function updateClock() {
  const now = new Date();
  document.getElementById('clock').innerText = now.toLocaleTimeString('de-DE');
}

// Initialer Aufruf
updateDashboard();
updateClock();

// Intervalle
setInterval(updateClock, 1000);
setInterval(updateDashboard, 30000); // Alle 30 Sekunden Daten neu laden
</script>
</body>
</html>
